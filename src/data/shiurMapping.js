/**
 * Mapping of Nach books to Kol Halashon shiur IDs for Rav Breitowitz's shiurim
 *
 * Data source: https://www2.kolhalashon.com/en/regularSite/ravs/9991
 *
 * The Nach Yomi cycle covers all books of Nevi'im (Prophets) and Kesuvim (Writings)
 * with one chapter per day over a 2-year cycle.
 */

// Shiur IDs mapped by book and chapter
// Format: bookName -> { chapterNumber: shiurId }
export const shiurMapping = {
  // === NEVI'IM RISHONIM (Early Prophets) ===

  "Joshua": {
    1: 31470133, 2: 31470135, 3: 31470137, 4: 31470138, 5: 31470139,
    6: 31472601, 7: 31472602, 8: 31472604, 9: 31472606, 10: 31472607,
    11: 31574538, 12: 31574542, 13: 31574543, 14: 31574549, 15: 31574550,
    16: 31576723, 17: 31576724, 18: 31576725, 19: 31576726, 20: 31576727,
    21: 31576728, 22: 31576729, 23: 31576732, 24: 31576735
  },

  // Note: The following books need their shiur IDs mapped by scraping the Kol Halashon pages
  // For now, we'll use null to indicate the shiur exists but needs ID lookup
  // The bot will fall back to the book's main page when specific shiur ID is not available

  "Judges": {
    1: 31593902, 2: 31593904, 3: 31593905, 4: 31593906, 5: 31594825,
    6: 31598992, 7: 31598993, 8: 31598995, 9: 31598998, 10: 31627039,
    11: 31627040, 12: 31627041, 13: 31627042, 14: 31627043, 15: 31627045,
    16: 31643376, 17: 31644590, 18: 31644591, 19: 31644611, 20: 31644595,
    21: 31644596
  },

  "I Samuel": {
    1: 31644639, 2: 31644641, 3: 31644643, 4: 31645697, 5: 31645698,
    6: 31645699, 7: 31645700, 8: 31645701, 9: 31646164, 10: 31650841,
    11: 31650842, 12: 31650843, 13: 31650844, 14: 31650845, 15: 31650846,
    16: 31653363, 17: 31656285, 18: 31660293, 19: 31660763, 20: 31661290,
    21: 31695626, 22: 31695738, 23: 31698099, 24: 31698100, 25: 31698767,
    26: 31698768, 27: 31698792, 28: 31700641, 29: 31701207, 30: 31701208,
    31: 31701209
  },

  "II Samuel": {
    1: 31716183, 2: 31716184, 3: 31716185, 4: 31716186, 5: 31716187,
    6: 31716188, 7: 31716189, 8: 31716607, 9: 31716190, 10: 31714618,
    11: 31716191, 12: 31716192, 13: 31714619, 14: 31714620, 15: 31714617,
    16: 31716608, 17: 31716609, 18: 31716610, 19: 31718786, 20: 31718794,
    21: 31718787, 22: 31720080, 23: 31720082, 24: 31720931
  },

  "I Kings": {
    1: 31753952, 2: 31754564, 3: 31756403, 4: 31756404, 5: 31757618,
    6: 32438273, 7: 32438641, 8: 32439301, 9: 32439239, 10: 32440484,
    11: 32441116, 12: 32442218, 13: 32442750, 14: 32463897, 15: 32463898,
    16: 32465944, 17: 32466317, 18: 32467083, 19: 32467217, 20: 32483465,
    21: 32483580, 22: 32506026
  },

  "II Kings": {
    1: 32506097, 2: 32506261, 3: 32508968, 4: 32509364, 5: 32511699,
    6: 32512404, 7: 32512520, 8: 32513321, 9: 32513716, 10: 32515046,
    11: 32517523, 12: 32517562, 13: 32517563, 14: 32519361, 15: 32520309,
    16: 32520310, 17: 32521174, 18: 32521809, 19: 32975111, 20: 32978061,
    21: 32980441, 22: 32980442, 23: 32980878, 24: 32981353, 25: 32981757
  },

  // === NEVI'IM ACHARONIM (Later Prophets) ===

  "Isaiah": {
    1: 32996326, 2: 32996737, 3: 32997189, 4: 32997190, 5: 32998927,
    6: 32999902, 7: 33001162, 8: 33002466, 9: 33002628, 10: 33003012,
    11: 33015251, 12: 33015252, 13: 33015925, 14: 33015926, 15: 33018119,
    16: 33018121, 17: 33018693, 18: 33018702, 19: 33019195, 20: 33022319,
    21: 33022979, 22: 33022981, 23: 33033503, 24: 33035677, 25: 33036397,
    26: 33036401, 27: 33284023, 28: 33285177, 29: 33286144, 30: 33287362,
    31: 33287947, 32: 33287972, 33: 33288916, 34: 33288917, 35: 33288918,
    36: 33291013, 37: 33291018, 38: 33292130, 39: 33292926, 40: 33292927,
    41: 33304338, 42: 33304339, 43: 33306137, 44: 33307679, 45: 33307681,
    46: 33307686, 47: 33307687, 48: 33309938, 49: 33309939, 50: 33309940,
    51: 33312084, 52: 33312085, 53: 33312130, 54: 33312131, 55: 33312132,
    56: 33312133, 57: 33312134, 58: 33312135, 59: 33326833, 60: 33326834,
    61: 33327661, 62: 33327662, 63: 33328265, 64: 33328270, 65: 33328272,
    66: 33328319
  },
  "Jeremiah": {
    1: 33355674, 2: 33355728, 3: 33357192, 4: 33357194, 5: 33357195,
    6: 33357196, 7: 33361919, 8: 33361941, 9: 33361942, 10: 33375048,
    11: 33375547, 12: 33375548, 13: 33378317, 14: 33378764, 15: 33379892,
    16: 33380412, 17: 33380413, 18: 33380414, 19: 33380415, 20: 33394128,
    21: 33394129, 22: 33394130, 23: 33396848, 24: 33396849, 25: 33397417,
    26: 33397523, 27: 33397524, 28: 33398102, 29: 33401479, 30: 33401480,
    31: 33401481, 32: 33424624, 33: 33424625, 34: 33424626, 35: 33424627,
    36: 33427939, 37: 33427943, 38: 33427947, 39: 33427949, 40: 33427951,
    41: 33432209, 42: 33432210, 43: 33432211, 44: 33432212, 45: 33432213,
    46: 33447040, 47: 33447041, 48: 33447042, 49: 33447043, 50: 33464289,
    51: 33464290, 52: 33464291
  },
  "Ezekiel": {
    1: 33467237, 2: 33467238, 3: 33467240, 4: 33467242, 5: 33467243,
    6: 33467245, 7: 33467255, 8: 33483616, 9: 33483617, 10: 33483618,
    11: 33483633, 12: 33489661, 13: 33489663, 14: 33489664, 15: 33489666,
    16: 33513536, 17: 33513797, 18: 33513798, 19: 33513799, 20: 33513801,
    21: 33519603, 22: 33519604, 23: 33519605, 24: 33519607, 25: 33519608,
    26: 33537049, 27: 33537050, 28: 33537052, 29: 33537053, 30: 33538192,
    31: 33538193, 32: 33538194, 33: 33538245, 34: 33538246, 35: 33539511,
    36: 33540336, 37: 33540337, 38: 33542311, 39: 33542313, 40: 33546985,
    41: 33547034, 42: 33547035, 43: 33547756, 44: 34238335, 45: 34238336,
    46: 34238339, 47: 34238340, 48: 34238341
  },

  // === TREI ASAR (Twelve Minor Prophets) ===

  "Hosea": {
    1: 34253370, 2: 34253371, 3: 34253372, 4: 34257038, 5: 34257039,
    6: 34257040, 7: 34257042, 8: 34259439, 9: 34259440, 10: 34259942,
    11: 34259943, 12: 34260440, 13: 34260441, 14: 34260442
  },
  "Joel": {
    1: 34263019, 2: 34263020, 3: 34263021, 4: 34263022
  },
  "Amos": {
    1: 34277082, 2: 34277083, 3: 34277084, 4: 34277085, 5: 34280946,
    6: 34280947, 7: 34280948, 8: 34280949, 9: 34280950
  },
  "Obadiah": {
    1: 34299450
  },
  "Jonah": {
    1: 34299451, 2: 34299453, 3: 34299457, 4: 34299458
  },
  "Micah": {
    1: 34323388, 2: 34323389, 3: 34323390, 4: 34323391, 5: 34323392,
    6: 34323397, 7: 34323398
  },
  "Nahum": {
    1: 34344018, 2: 34344019, 3: 34344020
  },
  "Habakkuk": {
    1: 34346765, 2: 34346766, 3: 34346768
  },
  "Zephaniah": {
    1: 34348823, 2: 34348824, 3: 34348825
  },
  "Haggai": {
    1: 34348826, 2: 34348827
  },
  "Zechariah": {
    1: 34352847, 2: 34352848, 3: 34352849, 4: 34352850, 5: 34352852,
    6: 34352853, 7: 34364115, 8: 34364116, 9: 34364117, 10: 34364118,
    11: 34368074, 12: 34368075, 13: 34368077, 14: 34368078
  },
  "Malachi": {
    1: 34369281, 2: 34369282, 3: 34369283
  },

  // === KESUVIM (Writings) ===

  "Song of Songs": {
    1: 36331979, 2: 36331983, 3: 36335038, 4: 36335039, 5: 36335040,
    6: 36335041, 7: 36335042, 8: 36335043
  },
  "Ruth": {
    1: 37230755, 2: 37230756, 3: 37230757, 4: 37230758
  },
  "Lamentations": {
    1: 37262924, 2: 37262980, 3: 37264648, 4: 37264652, 5: 37264653
  },
  "Ecclesiastes": {
    1: 37284557, 2: 37284558, 3: 37297947, 4: 37299049, 5: 37300065,
    6: 37300066, 7: 37300067, 8: 37300121, 9: 37300894, 10: 37300895,
    11: 37300896, 12: 37300897
  },
  "Esther": {
    1: 37320434, 2: 37322149, 3: 37322150, 4: 37323399, 5: 37323388,
    6: 37325152, 7: 37346822, 8: 37346877, 9: 37346824, 10: 37346826
  },
  "Daniel": {
    1: 37350390, 2: 37351845, 3: 37353173, 4: 37353718, 5: 37354740,
    6: 37354741, 7: 37354748, 8: 37368164, 9: 37369345, 10: 37369491,
    11: 37370268, 12: 37370270
  },
  "Ezra": {
    1: 37373951, 2: 37376493, 3: 37397281, 4: 37397931, 5: 37397932,
    6: 37397934, 7: 37400445, 8: 37400446, 9: 37400447, 10: 37401680
  },
  "Nehemiah": {
    1: 37402629, 2: 37403992, 3: 37403993, 4: 37403994, 5: 37417391,
    6: 37417392, 7: 37417393, 8: 37417394, 9: 37419289, 10: 37419291,
    11: 37417395, 12: 37417397, 13: 37419292
  },
  "I Chronicles": {
    1: 37450637, 2: 37454632, 3: 37454944, 4: 37455943, 5: 38117281,
    6: 38118485, 7: 38122157, 8: 38122158, 9: 38123041, 10: 38123042,
    11: 38357938, 12: 38357939, 13: 38360840, 14: 38360841, 15: 38360842,
    16: 38360844, 17: 38360845, 18: 38360846, 19: 38377632, 20: 38377633,
    21: 38377809, 22: 38377810, 23: 38377811, 24: 38377812, 25: 38399082,
    26: 38399083, 27: 38400716, 28: 38400719, 29: 38400721
  },
  "II Chronicles": {
    1: 38417802, 2: 38417803, 3: 38417804, 4: 38419488, 5: 38419569,
    6: 38419570, 7: 38419571, 8: 38423221, 9: 38423222, 10: 38423223,
    11: 38436828, 12: 38436829, 13: 38436830, 14: 38436831, 15: 38436832,
    16: 38441389, 17: 38441390, 18: 38441391, 19: 38445822, 20: 38445823,
    21: 38445824, 22: 38445846, 23: 38445847, 24: 38465475, 25: 38465525,
    26: 38465512, 27: 38465483, 28: 38465487, 29: 38488986, 30: 38489585,
    31: 38489589, 32: 38489591, 33: 38507874, 34: 38507918, 35: 38508108,
    36: 38512436
  },

  // Psalms - 150 chapters
  "Psalms": {
    1: 34391329, 2: 34392469, 3: 34403377, 4: 34403378, 5: 34403379,
    6: 34406580, 7: 34407197, 8: 34407198, 9: 34407199, 10: 34407200,
    11: 34411047, 12: 34411048, 13: 34411049, 14: 34411050, 15: 34433306,
    16: 34433307, 17: 34433309, 18: 34457369, 19: 34457793, 20: 34457794,
    21: 34463150, 22: 34463151, 23: 34463152, 24: 34476193, 25: 34476194,
    26: 34478980, 27: 34478981, 28: 34478982, 29: 34478983, 30: 34478984,
    31: 34484823, 32: 34484824, 33: 34484825, 34: 34484826, 35: 34484827,
    36: 34484992, 37: 34484993, 38: 34484995, 39: 34484996, 40: 34484997,
    41: 34489171, 42: 34489172, 43: 34489173, 44: 34489174, 45: 34489175,
    46: 34489176, 47: 34505492, 48: 34505493, 49: 34505494, 50: 34505495,
    51: 34505496, 52: 34505497, 53: 34505498, 54: 34505499, 55: 34505500,
    56: 34505501, 57: 34512824, 58: 34512825, 59: 34512826, 60: 34512827,
    61: 34512829, 62: 35005306, 63: 35005307, 64: 35005308, 65: 35005309,
    66: 35005310, 67: 35005311, 68: 35005312, 69: 35005313, 70: 35054588,
    71: 35054589, 72: 35054590, 73: 35054591, 74: 35054592, 75: 35054593,
    76: 35054595, 77: 35059364, 78: 35059365, 79: 35059366, 80: 35061878,
    81: 35061879, 82: 35061881, 83: 35061882, 84: 35061883, 85: 35061884,
    86: 35061885, 87: 35061886, 88: 35061887, 89: 35061888, 90: 35298056,
    91: 35298057, 92: 35298058, 93: 35298059, 94: 35298060, 95: 35298061,
    96: 35298062, 97: 35298063, 98: 35298064, 99: 35298065, 100: 35298066,
    101: 35324869, 102: 35324870, 103: 35324871, 104: 35324872, 105: 35324873,
    106: 35361745, 107: 35361746, 108: 35361747, 109: 35361748, 110: 35361749,
    111: 35386759, 112: 35386760, 113: 35386761, 114: 35386763, 115: 35386764,
    116: 35388410, 117: 35388411, 118: 35388412, 119: 35388413,
    120: 35405669, 121: 35405670, 122: 35405671, 123: 35405672, 124: 35405673,
    125: 35405674, 126: 35405675, 127: 35405676, 128: 35865386, 129: 35865371,
    130: 35865373, 131: 35865374, 132: 35865375, 133: 35865376, 134: 35865377,
    135: 35865378, 136: 35865379, 137: 35865380, 138: 35865381, 139: 35865382,
    140: 35865383, 141: 35865384, 142: 35865385, 143: 35870799, 144: 35870800,
    145: 35870801, 146: 35870802, 147: 35870803, 148: 35935005, 149: 35935006,
    150: 35935008
  },

  // Proverbs - 31 chapters
  "Proverbs": {
    1: 35935210, 2: 35937813, 3: 35939726, 4: 35939727, 5: 35941613,
    6: 35942397, 7: 35954373, 8: 35955349, 9: 35956584, 10: 35956585,
    11: 35957743, 12: 35959216, 13: 35960211, 14: 35960212, 15: 35960213,
    16: 35963019, 17: 35963020, 18: 35963021, 19: 35963022, 20: 35963023,
    21: 35983869, 22: 35988739, 23: 35988740, 24: 35988741, 25: 35988784,
    26: 35988785, 27: 35989559, 28: 35989560, 29: 35989561, 30: 35988786,
    31: 35988787
  },

  // Job - 42 chapters
  "Job": {
    1: 36004973, 2: 36005412, 3: 36007438, 4: 36007439, 5: 36007440,
    6: 36007441, 7: 36007443, 8: 36008903, 9: 36012458, 10: 36010195,
    11: 36010196, 12: 36010197, 13: 36010198, 14: 36010199, 15: 36011369,
    16: 36011371, 17: 36011373, 18: 36012460, 19: 36012462, 20: 36025085,
    21: 36029653, 22: 36029654, 23: 36029655, 24: 36029730, 25: 36029731,
    26: 36029733, 27: 36029734, 28: 36031323, 29: 36031324, 30: 36031326,
    31: 36069554, 32: 36031329, 33: 36031330, 34: 36069556, 35: 36069557,
    36: 36069558, 37: 36069559, 38: 36069560, 39: 36069562, 40: 36069563,
    41: 36069564, 42: 36069565
  }
};

// Name mappings between Hebcal format and our internal format
export const hebcalToInternal = {
  "Joshua": "Joshua",
  "Judges": "Judges",
  "I Samuel": "I Samuel",
  "II Samuel": "II Samuel",
  "I Kings": "I Kings",
  "II Kings": "II Kings",
  "Isaiah": "Isaiah",
  "Jeremiah": "Jeremiah",
  "Ezekiel": "Ezekiel",
  "Hosea": "Hosea",
  "Joel": "Joel",
  "Amos": "Amos",
  "Obadiah": "Obadiah",
  "Jonah": "Jonah",
  "Micah": "Micah",
  "Nahum": "Nahum",
  "Habakkuk": "Habakkuk",
  "Zephaniah": "Zephaniah",
  "Haggai": "Haggai",
  "Zechariah": "Zechariah",
  "Malachi": "Malachi",
  "Psalms": "Psalms",
  "Proverbs": "Proverbs",
  "Job": "Job",
  "Song of Songs": "Song of Songs",
  "Ruth": "Ruth",
  "Lamentations": "Lamentations",
  "Ecclesiastes": "Ecclesiastes",
  "Esther": "Esther",
  "Daniel": "Daniel",
  "Ezra": "Ezra",
  "Nehemiah": "Nehemiah",
  "I Chronicles": "I Chronicles",
  "II Chronicles": "II Chronicles"
};

// Hebrew names for display
export const hebrewNames = {
  "Joshua": "יהושע",
  "Judges": "שופטים",
  "I Samuel": "שמואל א",
  "II Samuel": "שמואל ב",
  "I Kings": "מלכים א",
  "II Kings": "מלכים ב",
  "Isaiah": "ישעיהו",
  "Jeremiah": "ירמיהו",
  "Ezekiel": "יחזקאל",
  "Hosea": "הושע",
  "Joel": "יואל",
  "Amos": "עמוס",
  "Obadiah": "עובדיה",
  "Jonah": "יונה",
  "Micah": "מיכה",
  "Nahum": "נחום",
  "Habakkuk": "חבקוק",
  "Zephaniah": "צפניה",
  "Haggai": "חגי",
  "Zechariah": "זכריה",
  "Malachi": "מלאכי",
  "Psalms": "תהלים",
  "Proverbs": "משלי",
  "Job": "איוב",
  "Song of Songs": "שיר השירים",
  "Ruth": "רות",
  "Lamentations": "איכה",
  "Ecclesiastes": "קהלת",
  "Esther": "אסתר",
  "Daniel": "דניאל",
  "Ezra": "עזרא",
  "Nehemiah": "נחמיה",
  "I Chronicles": "דברי הימים א",
  "II Chronicles": "דברי הימים ב"
};

// Kol Halashon filter IDs for each Nach book (used for searching/filtering)
export const kolHalashonBookIds = {
  "Joshua": 288649,
  "Judges": 288650,
  "I Samuel": 288651,
  "II Samuel": 288652,
  "I Kings": 288653,
  "II Kings": 288654,
  "Isaiah": 288655,
  "Jeremiah": 288656,
  "Ezekiel": 288657,
  "Hosea": 288658,
  "Joel": 288659,
  "Amos": 288660,
  "Obadiah": 288661,
  "Jonah": 288662,
  "Micah": 288663,
  "Nahum": 288664,
  "Habakkuk": 288665,
  "Zephaniah": 288666,
  "Haggai": 288667,
  "Zechariah": 288668,
  "Malachi": 288669,
  "Psalms": 288670,
  "Proverbs": 288671,
  "Job": 288672,
  "Song of Songs": 288673,
  "Ruth": 288674,
  "Lamentations": 288675,
  "Ecclesiastes": 288676,
  "Esther": 288677,
  "Daniel": 288678,
  "Ezra": 288679,
  "Nehemiah": 288680,
  "I Chronicles": 288681,
  "II Chronicles": 288682
};

/**
 * Get the Kol Halashon shiur URL for a specific chapter
 */
export function getShiurUrl(book, chapter) {
  const bookData = shiurMapping[book];

  if (bookData && typeof bookData === 'object' && bookData[chapter]) {
    // We have a specific shiur ID
    return `https://www2.kolhalashon.com/en/regularSite/playShiur/${bookData[chapter]}`;
  }

  // Fallback to Rav Breitowitz's Nach page with book filter
  const bookId = kolHalashonBookIds[book];
  if (bookId) {
    return `https://www2.kolhalashon.com/en/regularSite/ravs/9991?urlFilters=26:${bookId}|`;
  }

  // Ultimate fallback - Rav Breitowitz's main Nach page
  return "https://www2.kolhalashon.com/en/regularSite/ravs/9991?urlFilters=25:288648|";
}

/**
 * Get Sefaria URL for the chapter text
 */
export function getSefariaUrl(book, chapter) {
  const sefariaBook = book.replace(/ /g, "_");
  return `https://www.sefaria.org/${sefariaBook}.${chapter}`;
}

/**
 * Get Sefaria API URL for fetching text
 */
export function getSefariaApiUrl(book, chapter) {
  const sefariaBook = book.replace(/ /g, "_");
  return `https://www.sefaria.org/api/texts/${sefariaBook}.${chapter}?context=0&pad=0`;
}

/**
 * Get the shiur ID for a specific book and chapter
 */
export function getShiurId(book, chapter) {
  const bookData = shiurMapping[book];
  if (bookData && typeof bookData === 'object' && bookData[chapter]) {
    return bookData[chapter];
  }
  return null;
}

/**
 * Get the thumbnail URL for a shiur
 */
export function getShiurThumbnailUrl(shiurId) {
  if (!shiurId) return null;
  // Thumbnail URL pattern: /imgs/VideoThumbNails/{first5digits}/{shiurId}.jpg
  const prefix = String(shiurId).substring(0, 5);
  return `https://www2.kolhalashon.com/imgs/VideoThumbNails/${prefix}/${shiurId}.jpg`;
}

/**
 * Get the MP3 audio URL for a shiur (for embedding in Telegram)
 * This URL is used in the "Listen" mode of Kol Halashon
 */
export function getShiurAudioUrl(shiurId) {
  if (!shiurId) return null;
  return `https://www2.kolhalashon.com/api/files/GetMp3FileToPlay/${shiurId}`;
}

/**
 * Get the HLS video stream URL for a shiur
 * Pattern: https://media2.kolhalashon.com:9001/KHL_Video/_definst_/amlst:NewArchive/HD/{prefix}/{shiurId}/playlist.m3u8
 */
export function getShiurVideoUrl(shiurId) {
  if (!shiurId) return null;
  const prefix = String(shiurId).substring(0, 5);
  return `https://media2.kolhalashon.com:9001/KHL_Video/_definst_/amlst:NewArchive/HD/${prefix}/${shiurId}/playlist.m3u8`;
}
